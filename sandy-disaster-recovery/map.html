<html>
<head>
  <!-- Latest compiled and minified CSS -->
  <title>{{organization_map_title}}</title>
  <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/main.css">
   
<!--       <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script> -->

  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
      <script type="text/javascript" src="javascript/messi.js"></script>       
      <link rel="stylesheet" href="stylesheets/messi.css">
    <script type="text/javascript" src="javascript/map_clusterer.js"></script>       
<!--     <script type="text/javascript" src="javascript/typeahead.js"></script>       -->

    <script type="text/javascript" src="javascript/private_map.js"></script>      
    <script type="text/javascript" src="javascript/map_get_legend.js"></script>      

<script type="text/javascript">
var forms_json = "{{ forms_json }}";
;
</script>
<style type="text/css" >
body { background-color: #d4d4d4; }
</style>
      <style type="text/css">
      html { height: 100% }
      body { height: 100%; margin: 0; padding: 0 }
      #map-canvas { height: 100% }
    </style>
    <script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?sensor=false">
    </script>
    <script type="text/javascript">
    // TODO
    // get center from inc def
      function initialize() {
        var mapOptions = {
          center: new google.maps.LatLng({{organization_map_latitude}}, {{organization_map_longitude}}),
          zoom: {{organization_map_zoom}}
        };
        var map = new google.maps.Map(document.getElementById("map-canvas"),
            mapOptions);
	var ctaLayer = new google.maps.KmlLayer({
	  url: "{{kml_layer}}"
	});
	ctaLayer.setMap(map);
	MarkerClusterer.IMAGE_PATH = "/icons/m";
	var markerCluster = new MarkerClusterer(map);
	clusterer = markerCluster;
      }
      
      google.maps.event.addDomListener(window, 'load', initialize);
      populateMapByIncident("{{shortname}}", 0, []);

    </script>
</head>

<body>
    
    <div class="container">
      <!-- Example row of columns -->
      <div class="row">

        <div class="col-md-2">
	  <br>

	  {{ menubox }}
	  <br />Search: <input id="search_box" style="width:200px" />

	  <div id="legend_div">
	    <h2>Legend</h2>
	  </div>
	  <div id="filters_div">
	    <h2>Filters</h2>
	  </div>
	  <br>
	  <p>Download Spreadsheet (CSV):</p>
	  <form method="POST" action="/export" target="_blank" id="csv_form">
	  <input name="id" class="id_list" type="hidden" value="" />
	  <button type="submit" class="export-btn" id="filtered-export-btn" name="download" value="selected">
	  Download Visible
	  </button>
	  <button type="submit" class="all-export-btn" id="all-export-btn" name="download" value="all">
	    Download All
	  </button>
	  <br>
	  <div id="export-wait-message" style="display: none; margin-top: 10px;">
	    <div id="export-spinner" style="display: inline-block; float: right;"></div>
	    This download may take<br>
	    a number of minutes.<br>
	    Please wait...
	  </div>
	</form>

        </div>
        <div class="col-md-10" id="id_map">
	  <div id="map-canvas"></div>
       </div>
       
	<div class="col-md-0" id="collapsible">
	 <table id="form_table">
	  {{ single_site }}
	  </table>
	  
       </div>
       <br>

      </div>

    </div> <!-- /container -->

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://netdna.bootstrapcdn.com/bootstrap/3.0.2/js/bootstrap.min.js"></script>


</html>

