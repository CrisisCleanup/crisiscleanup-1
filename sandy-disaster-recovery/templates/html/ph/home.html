{% extends "base_template.html" %}

{% block home %}
class="active"
{% endblock %}



{% block head_content %}
    <script src="/closure/goog/base.js?v={{version}}"></script>
    <script src="/javascript/deps.js?v={{version}}"></script>
    <script type="text/javascript">
        goog.require("sandy.{% if demo %}demo{% else %}main{% endif %}");
    </script>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="assets/js/libs/jquery-1.11.0.min.js"><\/script>')</script>

<script type="text/javascript"
        src="https://maps.googleapis.com/maps/api/js?sensor=false">
</script>

<script type="text/javascript">
    function initialize() {


    }
</script>

<script type="text/javascript" src="javascript/ph/public_map15.js"></script>

<script type="text/javascript" src="javascript/map_clusterer.js"></script>
<script type="text/javascript" src="javascript/messi.js"></script>
<link rel="stylesheet" href="stylesheets/messi.css">
<link rel="stylesheet" href="assets/css/public-map.css">


{% endblock %}




{% block sidebar_content %}
    <div>
        <form id="site-filter" method="GET" role="form">
            {{ form.page }}
            <div class="form-group">
                <label for="date_from">From</label>
                <div class="datepicker input-group date form-group">
                    {{ form.date_from(class_='form-control input-sm') }}
                    <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                </div>
            </div>
            <span class="add-on"><i class="icon-calendar"></i></span>
            <div class="form-group">
                <label for="date_to">To</label>
                <div class="datepicker input-group date form-group">
                    {{ form.date_to(class_='form-control input-sm') }}
                    <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                </div>
            </div>
            <div class="form-group">
                <label for="county_and_state">County &amp; State</label>
                {{ form.county_and_state(class_='form-control input-sm') }}
            </div>
            <div class="form-group">
                <label for="order">Order</label><br />
                {{ form.order(class_='form-control input-sm') }}<br />
            </div>
            <strong>Categories</strong>
            <div class="checkbox">
                <label>
                {{ form.work_type }}
                </label>
            </div>
        </form>
    </div>

{% endblock %}

{% block main_content %}

    <div id="home-map">

        {#
        <h2>Incidents</h2>
        {% for event in events %}
        <p class="MapIncident" id="{{event.short_name}}">{{event.name}}</p>
        {% endfor %}
        #}

        <div id="display_incident" class="hidden"></div>
        <div id="display_filter"></div>
        <div id="map_canvas"></div>

    </div>

    <div id="home-messages">
        {%- macro previous_and_next() -%}
        <p>
            {% if form.page.data %}
            [<a href="#" class="change-page" data-change="-1">Previous Page</a>]
            {% endif %}

            {% if sites|length == sites_per_page %}
            [<a href='#' class="change-page" data-change="+1">Next Page</a>]
            {% endif %}
        </p>
        {%- endmacro -%}

        {{ previous_and_next() }}

        <p>&nbsp;</p>
        <table class="table table-striped">
            <thead>
            <tr>
                <th>Date</th>
                {% if logged_in %}
                    <th>Name</th>
                    <th>Gender</th>
                    <th>Correct response</th>
                {% endif %}

                <th>Category</th>
                <th>Message</th>
                <th>County</th>
                <th>Region</th>
            </tr>
            </thead>
            <tbody>
            {% for site in sites %}
            <tr>
                <td>{{ site.request_date.strftime('%Y-%m-%d') }}</td>
                {% if logged_in %}
                    <td>{{ site.name }}</td>
                    <td>{{ site.gender }}</td>
                    <td>{{ site.correct }}</td>
                {% endif %}
                <td>{{ site.categories }}</td>
                <td>{{ site.message|truncate(100) }}</td>
                <td>{{ site.county }}</td>
                <td>{{ site.state }}</td>
            </tr>
            {% endfor %}
            </tbody>
        </table>

        {{ previous_and_next() }}

        <p class="pull-right">
            <a href="/export">Download (CSV)</a>
        </p>

    </div>
{% endblock %}









{% block scripts %}
<script type="text/javascript">
    $(function() {

        $('.datepicker').datetimepicker({
            pickTime: false
            })
            .on('changeDate', function(ev){
                $('form#site-filter').submit()
            });


        $(document).ready(function() {
            // populate map
            clusterer.clearMarkers();
            categories = $('input[name=categories]:checked').val()
            populateMapByIncident('yolanda', 0, categories,[]);
        });


        // show wait cursor when form is submitted
        $('form').on('submit', function() {
            $('body').addClass('wait-cursor');
        });

        // submit form on change of select
        $('select').change(function() {
            $(this).parent('form').submit();
        });

        $('input[type=checkbox]').change(function() {
            $('form#site-filter').submit()
        });

        /*
        $('input[type=text]').blur(function() {
            $('form#site-filter').submit()
        });
        */

        // submit form on click of prev or next links
        $('a.change-page').click(function() {
            var newPageNum = {{ form.page.data }} + parseInt($(this).attr('data-change'));
        $('input[name=page]').val(newPageNum);
        $('form#site-filter').submit()
    });

    });

</script>
{% endblock %}










        {#
{% block banner %}
   <article role="main" class="clearfix">
       <div class="post">
         {{ home_banner_page_block|safe }}
       </div>
   </article>
{% endblock %}

{% block description_title %}
{{ home_description_title_page_block|safe }}
{% endblock %}

{% block description_subtitle %}
{{ home_description_subtitle_page_block|safe }}
{% endblock %}

{% block sidebar_title %}
{{ home_sidebar_title_page_block|safe}}
{% endblock %}

{% block sidebar_content %}
{{ home_sidebar_content_page_block|safe }}
{% endblock %}

{% block main_title %}
{{ home_main_title_page_block|safe }}
{% endblock %}

{% block main_content %}
{{ home_main_content_page_block|safe }}
{% endblock %}
        #}
