{% extends "base_template_without_log_in_checks.html" %}

{% block head_content %}

{% endblock %}

{% block sites %}
class="active"
{% endblock %}


{% block description_title %}
{% endblock %}

{% block description_subtitle %}
{% endblock %}

{% block sidebar_title %}
{% endblock %}

{% block sidebar_content %}
    <form id="site-filter" method="GET" role="form">
        {{ form.page }}
        <div class="form-group">
            <label for="county_and_state">Town/City</label>
            {{ form.county_and_state(class_='form-control input-sm') }}
        </div>
        <div class="form-group">
            <label for="order">Order</label>
            {{ form.order(class_='form-control input-sm') }}
        </div>
    </form>
{% endblock %}

{% block main_title %}
    Messages
{% endblock %}

{% block main_content %}

{%- macro previous_and_next() -%}
    <p>
        {% if form.page.data %}
        [<a href="#" class="change-page" data-change="-1">Previous Page</a>]
        {% endif %}

        {% if sites|length == sites_per_page %}
        [<a href='#' class="change-page" data-change="+1">Next Page</a>]
        {% endif %}
    </p>
{%- endmacro -%}

{{ previous_and_next() }}


    <table class="table table-striped">
        <thead>
        <tr>
            <th>Date</th>
            <th>Name</th>
            <th>Gender</th>
            <th>Response</th>
            <th>Categories</th>
            <th>Message</th>
            <th>Town</th>
            <th>Region</th>
            <th></th>
        </tr>
        </thead>
        <tbody>
        {% for site in sites %}
        <tr>
            <td>{{ site.request_date.strftime('%m/%d/%Y') }}</td>
            <td>{{ site.name }}</td>
            <td>{{ site.gender }}</td>
            <td>{% if site.correct == 'y' %}correct{% endif %}</td>
            <td>{{ site.work_type }}</td>
            <td>{{ site.message|truncate(100) }}</td>
            <td>{{ site.county }}</td>
            <td>{{ site.state }}</td>
            <td>
                [<a href="/edit?id={{ site.key().id() }}">Edit</a>]
                {###### [<a href="/delete?id={{ site.key().id() }}">Delete</a>] #}
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>

    {{ previous_and_next() }}

    <p class="pull-right">
        <a href="/export_all_download">Download All (CSV)</a>
    </p>

{% endblock %}

{% block scripts %}
    <script type="text/javascript">
        $(function() {

            // show wait cursor when form is submitted
            $('form').on('submit', function() {
                $('body').addClass('wait-cursor');
            });

            // submit form on change of select
            $('select').change(function() {
                $(this).parent('form').submit();
            });

            // submit form on click of prev or next links
            $('a.change-page').click(function() {
                var newPageNum = {{ form.page.data }} + parseInt($(this).attr('data-change'));
            $('input[name=page]').val(newPageNum);
            $('form#site-filter').submit()
        });

        });
    </script>
{% endblock %}
